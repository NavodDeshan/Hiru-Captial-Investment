{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import'./../css/ViewAllCustomers.css';// Correct path to ViewAllCustomers.css\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ViewAllCustomers=()=>{const[customers,setCustomers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[paymentHistory,setPaymentHistory]=useState([]);// Store payment history for the selected customer\nconst[selectedCustomer,setSelectedCustomer]=useState(null);// Track the selected customer\nconst[paymentLoading,setPaymentLoading]=useState(false);// Track loading state for payment history\nconst[paymentError,setPaymentError]=useState('');// Track errors for payment history\nuseEffect(()=>{const fetchCustomers=async()=>{try{const response=await axios.get('http://localhost:5000/api/customers');setCustomers(response.data);setLoading(false);}catch(err){setError('An error occurred while fetching customers.');setLoading(false);}};fetchCustomers();},[]);const fetchPaymentHistory=async fullName=>{setPaymentLoading(true);setPaymentError('');try{const response=await axios.get(\"http://localhost:5000/api/customers/\".concat(fullName,\"/payments\"));setPaymentHistory(response.data);// Store the payment history\nsetSelectedCustomer(fullName);// Set the selected customer\nsetPaymentLoading(false);}catch(err){console.error('Error fetching payment history:',err);setPaymentHistory([]);// Clear payment history on error\nsetPaymentError('Failed to fetch payment history. Please try again.');setPaymentLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"view-all-customers\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"All Customers\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}):error?/*#__PURE__*/_jsx(\"p\",{className:\"error\",children:error}):/*#__PURE__*/_jsx(\"div\",{className:\"customers-list\",children:customers.map(customer=>/*#__PURE__*/_jsxs(\"div\",{className:\"customer-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:customer.fullName}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Customer ID:\"}),\" \",customer._id]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Birthday:\"}),\" \",new Date(customer.birthday).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address:\"}),\" \",customer.address]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"ID Number:\"}),\" \",customer.idNumber]}),customer.idImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"image-section\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"ID Image:\"}),/*#__PURE__*/_jsx(\"img\",{src:\"http://localhost:5000/\".concat(customer.idImage),alt:\"\".concat(customer.fullName,\"'s ID\")})]}),customer.electricityBillImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"image-section\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Electricity Bill:\"}),/*#__PURE__*/_jsx(\"img\",{src:\"http://localhost:5000/\".concat(customer.electricityBillImage),alt:\"\".concat(customer.fullName,\"'s Electricity Bill\")})]}),/*#__PURE__*/_jsx(\"button\",{className:\"view-payments-button\",onClick:()=>fetchPaymentHistory(customer.fullName),children:\"View Payment History\"}),selectedCustomer===customer.fullName&&/*#__PURE__*/_jsxs(\"div\",{className:\"payment-history\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Payment History\"}),paymentLoading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading payment history...\"}):paymentError?/*#__PURE__*/_jsx(\"p\",{className:\"error\",children:paymentError}):paymentHistory.length>0?/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Loan ID\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paymentHistory.map(payment=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:new Date(payment.date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:payment.Amount}),/*#__PURE__*/_jsx(\"td\",{children:payment.LoanID})]},payment._id))})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No payment history found for this customer.\"})]})]},customer._id))})]});};export default ViewAllCustomers;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","ViewAllCustomers","customers","setCustomers","loading","setLoading","error","setError","paymentHistory","setPaymentHistory","selectedCustomer","setSelectedCustomer","paymentLoading","setPaymentLoading","paymentError","setPaymentError","fetchCustomers","response","get","data","err","fetchPaymentHistory","fullName","concat","console","className","children","map","customer","_id","Date","birthday","toLocaleDateString","address","idNumber","idImage","src","alt","electricityBillImage","onClick","length","payment","date","Amount","LoanID"],"sources":["D:/hiru/Hiru-Captial-Investment/frontend/src/pages/ViweAllCustomers.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport './../css/ViewAllCustomers.css'; // Correct path to ViewAllCustomers.css\r\n\r\nconst ViewAllCustomers = () => {\r\n  const [customers, setCustomers] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [paymentHistory, setPaymentHistory] = useState([]); // Store payment history for the selected customer\r\n  const [selectedCustomer, setSelectedCustomer] = useState(null); // Track the selected customer\r\n  const [paymentLoading, setPaymentLoading] = useState(false); // Track loading state for payment history\r\n  const [paymentError, setPaymentError] = useState(''); // Track errors for payment history\r\n\r\n  useEffect(() => {\r\n    const fetchCustomers = async () => {\r\n      try {\r\n        const response = await axios.get('http://localhost:5000/api/customers');\r\n        setCustomers(response.data);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        setError('An error occurred while fetching customers.');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchCustomers();\r\n  }, []);\r\n\r\n  const fetchPaymentHistory = async (fullName) => {\r\n    setPaymentLoading(true);\r\n    setPaymentError('');\r\n    try {\r\n      const response = await axios.get(`http://localhost:5000/api/customers/${fullName}/payments`);\r\n      setPaymentHistory(response.data); // Store the payment history\r\n      setSelectedCustomer(fullName); // Set the selected customer\r\n      setPaymentLoading(false);\r\n    } catch (err) {\r\n      console.error('Error fetching payment history:', err);\r\n      setPaymentHistory([]); // Clear payment history on error\r\n      setPaymentError('Failed to fetch payment history. Please try again.');\r\n      setPaymentLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"view-all-customers\">\r\n      <h2>All Customers</h2>\r\n      {loading ? (\r\n        <p>Loading...</p>\r\n      ) : error ? (\r\n        <p className=\"error\">{error}</p>\r\n      ) : (\r\n        <div className=\"customers-list\">\r\n          {customers.map((customer) => (\r\n            <div key={customer._id} className=\"customer-card\">\r\n              <h3>{customer.fullName}</h3>\r\n              <p><strong>Customer ID:</strong> {customer._id}</p>\r\n              <p><strong>Birthday:</strong> {new Date(customer.birthday).toLocaleDateString()}</p>\r\n              <p><strong>Address:</strong> {customer.address}</p>\r\n              <p><strong>ID Number:</strong> {customer.idNumber}</p>\r\n              {customer.idImage && (\r\n                <div className=\"image-section\">\r\n                  <strong>ID Image:</strong>\r\n                  <img src={`http://localhost:5000/${customer.idImage}`} alt={`${customer.fullName}'s ID`} />\r\n                </div>\r\n              )}\r\n              {customer.electricityBillImage && (\r\n                <div className=\"image-section\">\r\n                  <strong>Electricity Bill:</strong>\r\n                  <img src={`http://localhost:5000/${customer.electricityBillImage}`} alt={`${customer.fullName}'s Electricity Bill`} />\r\n                </div>\r\n              )}\r\n              {/* Button to fetch payment history */}\r\n              <button\r\n                className=\"view-payments-button\"\r\n                onClick={() => fetchPaymentHistory(customer.fullName)}\r\n              >\r\n                View Payment History\r\n              </button>\r\n              {/* Display payment history if this customer is selected */}\r\n              {selectedCustomer === customer.fullName && (\r\n                <div className=\"payment-history\">\r\n                  <h4>Payment History</h4>\r\n                  {paymentLoading ? (\r\n                    <p>Loading payment history...</p>\r\n                  ) : paymentError ? (\r\n                    <p className=\"error\">{paymentError}</p>\r\n                  ) : paymentHistory.length > 0 ? (\r\n                    <table>\r\n                      <thead>\r\n                        <tr>\r\n                          <th>Date</th>\r\n                          <th>Amount</th>\r\n                          <th>Loan ID</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {paymentHistory.map((payment) => (\r\n                          <tr key={payment._id}>\r\n                            <td>{new Date(payment.date).toLocaleDateString()}</td>\r\n                            <td>{payment.Amount}</td>\r\n                            <td>{payment.LoanID}</td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  ) : (\r\n                    <p>No payment history found for this customer.</p>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ViewAllCustomers;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}